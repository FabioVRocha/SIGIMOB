{% extends "base.html" %}

{% block title %}Modelos de Contrato{% endblock %}
{% block page_title %}Modelos de Contrato{% endblock %}

{% block content %}
<div class="bg-white p-6 rounded-lg shadow-xl content-section">
  <div class="flex justify-between items-center mb-4">
    <form method="get" class="flex items-center">
      <input type="text" name="search" value="{{ search_query }}" class="form-input filter-input mr-2" placeholder="Pesquisar modelo...">
      <button class="btn-secondary" type="submit">Buscar</button>
    </form>
    <a href="{{ url_for('contrato_modelos_add') }}" class="btn-primary"><i class="fas fa-plus mr-2"></i>Novo Modelo</a>
  </div>

  <div class="mb-4 text-sm text-gray-600">
    Utilize placeholders entre colchetes para preencher dados automaticamente, por exemplo: [Cliente], [CPF], [EnderecoImovel], [EmpresaNome], [DataInicio].
  </div>

  <table class="min-w-full bg-white rounded-lg overflow-hidden">
    <thead class="table-header-bg">
      <tr>
        <th class="py-3 px-4 text-left text-sm font-semibold text-white">ID</th>
        <th class="py-3 px-4 text-left text-sm font-semibold text-white">Nome</th>
        <th class="py-3 px-4 text-left text-sm font-semibold text-white">Atualizado em</th>
        <th class="py-3 px-4 text-right text-sm font-semibold text-white">Ações</th>
      </tr>
    </thead>
    <tbody>
      {% for m in modelos %}
      <tr class="border-b border-gray-200 {% if loop.index % 2 == 1 %}table-row-odd{% else %}table-row-even{% endif %}">
        <td class="py-3 px-4 text-sm text-gray-700">{{ m.id }}</td>
        <td class="py-3 px-4 text-sm text-gray-700">{{ m.nome }}</td>
        <td class="py-3 px-4 text-sm text-gray-700">{{ m.data_atualizacao.strftime('%d/%m/%Y %H:%M') if m.data_atualizacao else '' }}</td>
        <td class="py-3 px-4 text-sm text-gray-700 text-right">
          {% if request.args.get('contrato_id') %}
          <a href="{{ url_for('contrato_preview', contrato_id=request.args.get('contrato_id')) }}?modelo_id={{ m.id }}" class="text-green-600 hover:text-green-800 mr-3" title="Pré-visualizar"><i class="fas fa-file-signature"></i></a>
          {% endif %}
          <a href="{{ url_for('contrato_modelos_edit', id=m.id) }}" class="text-blue-600 hover:text-blue-800 mr-3" title="Editar"><i class="fas fa-edit"></i></a>
          <form method="post" action="{{ url_for('contrato_modelos_delete', id=m.id) }}" class="inline" onsubmit="return confirm('Excluir este modelo?');">
            <button type="submit" class="text-red-600 hover:text-red-800" title="Excluir"><i class="fas fa-trash"></i></button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}

{% block scripts %}
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const currentPath = window.location.pathname;
    if (currentPath.startsWith('/contratos/modelos')) {
      // Remover seleção incorreta do menu Imóveis > Contratos de Aluguel
      const wrong = document.querySelector('a.sidebar-nav-item[href="/contratos"]');
      if (wrong) wrong.classList.remove('active');

      // Ativar Gerencial > Modelos de Contrato e expandir o submenu correto
      const right = document.querySelector('a.sidebar-nav-item[href="{{ url_for('contrato_modelos_list') }}"]');
      if (right) {
        document.querySelectorAll('.sidebar-nav-item.active').forEach(el => el.classList.remove('active'));
        right.classList.add('active');

        const gerSub = document.getElementById('gerencial-submenu');
        const gerToggle = document.getElementById('gerencial-toggle');
        if (gerSub && gerToggle) {
          gerSub.classList.remove('hidden');
          const arrow = gerToggle.querySelector('.arrow-icon');
          if (arrow) arrow.classList.add('rotate-90');
          gerToggle.classList.add('active');
        }

        const imSub = document.getElementById('imoveis-submenu');
        const imToggle = document.getElementById('imoveis-toggle');
        if (imSub && imToggle) {
          imSub.classList.add('hidden');
          const arrow2 = imToggle.querySelector('.arrow-icon');
          if (arrow2) arrow2.classList.remove('rotate-90');
          imToggle.classList.remove('active');
        }
      }
    }
  });
  </script>
{% endblock %}
