<!-- templates/financeiro/cobrancas/add.html -->
{% extends "base.html" %}

{% block body_class %}page-form-standard{% endblock %}

{% block title %}{{ 'Editar Cobrança' if cobranca else 'Nova Cobrança' }}{% endblock %}

{% block page_title %}{{ 'Editar Cobrança' if cobranca else 'Nova Cobrança' }}{% endblock %}

{% block content %}
<div class="form-page">
    <div class="main-header">
        <h1>{{ 'Editar Cobrança' if cobranca else 'Nova Cobrança' }}</h1>
        <div class="flex space-x-3">
            <a href="{{ url_for('cobrancas_list') }}" class="btn-secondary text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out flex items-center justify-center" title="Voltar">
                <i class="fas fa-arrow-left"></i>
            </a>
        </div>
    </div>
    <div class="content-section">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-semibold text-dark-blue">Registrar Cobrança</h2>
            <a href="{{ url_for('cobrancas_titulos') }}" class="btn-secondary flex items-center">
                <i class="fas fa-search mr-2"></i> Buscar Títulos Vencidos
            </a>
        </div>
        {% if conta %}
        <div class="mb-4">
            <p><strong>Título:</strong> {{ conta.titulo }}</p>
            <p><strong>Cliente:</strong> {{ cliente.razao_social_nome }}</p>
            <p><strong>Vencimento:</strong> {{ conta.data_vencimento.strftime('%d/%m/%Y') }}</p>
            <p><strong>Valor:</strong> {{ conta.valor_previsto | currency }}</p>
        </div>
        <form method="post" action="{% if cobranca %}{{ url_for('cobrancas_edit', id=cobranca.id) }}{% else %}{{ url_for('cobrancas_add') }}{% endif %}" class="space-y-4 flex flex-col h-full">
            <input type="hidden" name="conta_id" value="{{ conta.id }}">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="form-group">
                    <label for="cobrador" class="form-label">Cobrador</label>
                    <input type="text" id="cobrador" name="cobrador" class="form-input" value="{{ cobranca.cobrador if cobranca else '' }}">
                </div>
                <div class="form-group">
                    <label for="contato" class="form-label">Contato</label>
                    <input type="text" id="contato" name="contato" class="form-input" value="{{ cobranca.contato if cobranca else '' }}">
                </div>
                <div class="form-group">
                    <label for="data_cobranca" class="form-label">Data da Cobrança</label>
                    <input type="date" id="data_cobranca" name="data_cobranca" class="form-input" required value="{{ cobranca.data_cobranca.strftime('%Y-%m-%d') if cobranca else '' }}">
                </div>
                <div class="form-group">
                    <label for="data_prevista_pagamento" class="form-label">Data Prevista do Pagamento</label>
                    <input type="date" id="data_prevista_pagamento" name="data_prevista_pagamento" class="form-input" value="{{ cobranca.data_prevista_pagamento.strftime('%Y-%m-%d') if cobranca and cobranca.data_prevista_pagamento else '' }}">
                </div>
                <div class="form-group md:col-span-2">
                    <label for="historico" class="form-label">Histórico</label>
                    <textarea id="historico" name="historico" class="form-input">{{ cobranca.historico if cobranca else '' }}</textarea>
                </div>
            </div>
            <div class="form-footer flex flex-wrap items-center gap-3 justify-end mt-auto">
                <button type="submit" class="btn-primary px-5 py-2 rounded-lg shadow-md text-sm">Salvar</button>
                <a href="{{ url_for('cobrancas_list') }}" class="btn-secondary px-5 py-2 rounded-lg shadow-md text-sm">
                    <i class="fas fa-arrow-left mr-2"></i> Cancelar
                </a>
            </div>
        </form>
        {% else %}
        <p class="text-center text-gray-600">Selecione um título para iniciar o registro da cobrança.</p>
        {% endif %}
    </div>
</div>
{% endblock %}
