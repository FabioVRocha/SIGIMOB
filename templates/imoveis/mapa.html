{% extends "base.html" %}

{% block title %}Mapa de Imóveis{% endblock %}
{% block page_title %}Mapa de Imóveis{% endblock %}

{% block content %}
<div id="map" style="height: 600px; width: 100%;"></div>
{% endblock %}

{% block scripts %}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const imoveis = {{ imoveis | tojson | safe }};

            const map = L.map('map').setView([-15.7801, -47.9292], 4);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);

            imoveis.forEach(imovel => {
                if (imovel.latitude && imovel.longitude) {
                    L.marker([imovel.latitude, imovel.longitude])
                        .addTo(map)
                        .bindPopup(
                            `<b>ID:</b> ${imovel.id}<br><b>Matrícula:</b> ${imovel.matricula || 'N/A'}`
                        );
                }
            });
        });
    </script>
{% endblock %}
